---
title: LSA - Light Sensor Array
---

## LSA - Light Sensor Array

### Table of Contents
- [LSA - Light Sensor Array](#lsa---light-sensor-array)
  - [Table of Contents](#table-of-contents)
  - [Overview](#overview)
  - [Components of LSA](#components-of-lsa)
  - [Function of Components](#function-of-components)
  - [Working Principle](#working-principle)
  - [Applications](#applications)
  - [Scope of Improvement](#scope-of-improvement)
  - [Description of Functions Used](#description-of-functions-used)

### Overview 
The Light Sensor Array (LSA) is used to detect white/black-lined surfaces and sends this data to the ESP32 microcontroller. This enables line-following behavior.

- **Physical PCB**  
  <img src="assets/lsa_pcb.jpeg" width="800" height="450">

- **PCB Model**  
  <img src="assets/lsa_pcb_model.jpeg" width="800" height="400">

### Components of LSA
| Component   | Description        | Quantity |
|------------|--------------------|----------|
| LED        | Emits light        | 4        |
| Photodiode | Detects reflected light | 4        |
| IC LM324   | Quad Op-Amp IC     | 1        |
| Resistors  | Current limiting   | 8        |

### Function of Components
- **LED**  
  Four LED–photodiode pairs emit white light onto the surface. Some light is absorbed by the surface, and the rest is reflected. LEDs are powered by VCC.

- **Photodiode**  
  Reflected light (depending on the surface reflectivity) is captured by photodiodes. The current generated by a photodiode is proportional to the received light intensity. Higher light intensity → higher current → higher sensor reading.

- **IC LM324**  
  This quad operational amplifier IC amplifies the weak current signal from the photodiodes. The amplified signals serve as the raw LSA output readings.

- **Resistors**  
  Current-limiting resistors protect the LEDs and photodiodes by controlling current flow.

### Working Principle
LSA works on the principle of varying reflectivity:
- **Black surface → High absorptivity → Low reflectivity**
- **White surface → Low absorptivity → High reflectivity**

- **Demonstration:**  
  <img src="assets/lsa_reflectivity.gif" width="650" height="600">

### Applications
- Primary application: Line-following robots.

### Scope of Improvement
- Susceptible to external light, leading to inaccurate readings. Keeping the LSA close to the ground improves performance.
- Currently supports only black and white detection. With better calibration and sensors, LSA can be extended to detect a range of RGB colors.

### Description of Functions Used
```c
esp_err_t enable_line_sensor(int mode)
```
**Description:** Enables and configures the ADC (Analog to Digital Converter).

**Returns:** `ESP_OK` on success, `ESP_ERR_INVALID_ARG` on failure.

```c
float bound(float val, float min, float max)
```
**Description:** Bounds the value `val` within the range `[min, max]`.

**Returns:** The bounded value.

```c
float map(float val, float input_lower_limit, float input_upper_limit, float output_lower_limit, float output_upper_limit)
```
**Description:** Maps `val` from the input range to a desired output range.

**Returns:** The mapped value.

```c
void vTaskDelay(const TickType_t xTicksToDelay)
```
**Description:** Delays a task for `xTicksToDelay` tick periods.

**Parameters:** `xTicksToDelay` — Number of tick periods to delay.